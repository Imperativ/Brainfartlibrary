<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P A C E M O N - Berechnung der Arbeitszeit</title>
    <style>
        /* CSS Reset and Variables */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-darkest: #0a0a0a;
            --bg-dark: #1a1a1a;
            --bg-medium: #2c2c2c;
            --bg-light: #3c3c3c;
            --text-primary: #ffffff;
            --text-secondary: #dcdcdc;
            --text-muted: #888888;
            --accent-orange: #ff9900;
            --accent-blue: #007bff;
            --color-present: #4caf50;
            --color-remaining: #ff9800;
            --color-overtime: #9c27b0;
            --border-color: #444444;
        }

        /* Base Styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-darkest) 0%, var(--bg-dark) 100%);
            color: var(--text-secondary);
            min-height: 100vh;
            position: relative;
        }

        /* Background Pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255,255,255,.01) 35px, rgba(255,255,255,.01) 70px),
                repeating-linear-gradient(-45deg, transparent, transparent 35px, rgba(255,255,255,.01) 35px, rgba(255,255,255,.01) 70px);
            pointer-events: none;
            z-index: 1;
        }

        /* Container */
        .container {
            position: relative;
            z-index: 2;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: var(--bg-medium);
            border-bottom: 2px solid var(--border-color);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 3px;
            color: var(--text-primary);
        }

        nav {
            display: flex;
            gap: 25px;
        }

        nav a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 5px 10px;
            transition: color 0.3s;
        }

        nav a:hover {
            color: var(--accent-orange);
        }

        /* Main Layout */
        .main-content {
            display: flex;
            gap: 40px;
        }

        .left-panel {
            flex: 1;
        }

        .right-panel {
            width: 200px;
        }

        /* Page Title */
        h1 {
            font-size: 28px;
            font-weight: 300;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        /* Digital Clock */
        .clock-container {
            background: var(--bg-medium);
            border: 2px solid var(--accent-orange);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        #digital-clock {
            font-size: 48px;
            font-weight: bold;
            color: var(--accent-orange);
            font-family: 'Courier New', monospace;
        }

        /* Input Form */
        .input-section {
            background: var(--bg-medium);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        label {
            display: inline-block;
            min-width: 180px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        input[type="time"],
        input[type="text"] {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            width: 150px;
        }

        input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        input:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        button {
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            background: #0056b3;
        }

        /* Results Section */
        .results-section {
            background: var(--bg-dark);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .result-item {
            display: flex;
            margin-bottom: 20px;
            min-height: 30px;
            align-items: flex-start;
        }

        .result-label {
            min-width: 200px;
            font-size: 14px;
            color: var(--text-muted);
            padding-top: 2px;
        }

        .result-value {
            font-size: 16px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .result-value p {
            margin: 0 0 5px 0;
        }

        .highlight {
            color: var(--accent-orange);
            font-weight: bold;
        }

        /* Timeline Bar */
        .timeline-container {
            background: var(--bg-dark);
            border-radius: 8px;
            padding: 25px;
        }

        .timeline-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .timeline-bar {
            height: 40px;
            background: var(--bg-darkest);
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }

        .timeline-segment {
            height: 100%;
            transition: width 0.5s ease;
        }

        .segment-present {
            background: linear-gradient(90deg, var(--color-present), #66bb6a);
        }

        .segment-remaining {
            background: linear-gradient(90deg, var(--color-remaining), #ffb74d);
        }

        .segment-overtime {
            background: linear-gradient(90deg, var(--color-overtime), #ba68c8);
        }

        /* Legend */
        .timeline-legend {
            display: flex;
            gap: 30px;
            margin-top: 15px;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 12px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">P A C E M O N</div>
            <nav>
                <a href="#">HOME</a>
                <a href="#">MONITORING</a>
                <a href="#">ORGANISATION</a>
                <a href="#">ADMINISTRATION</a>
                <a href="#">ANWENDUNGEN</a>
                <a href="#">ANGEMELDET</a>
            </nav>
        </header>

        <div class="main-content">
            <div class="left-panel">
                <h1>Berechnung der Arbeitszeit</h1>

                <div class="input-section">
                    <div class="form-row">
                        <label for="arbeitsbeginn">Arbeitsbeginn:</label>
                        <input type="time" id="arbeitsbeginn" value="08:54">
                    </div>
                    <div class="form-row">
                        <label for="tagessollzeit">Tagessollzeit:</label>
                        <input type="text" id="tagessollzeit" value="07h 54min" disabled>
                    </div>
                    <div class="form-row">
                        <label for="zusatzpause">Zusätzliche Arbeitsunterbrechungen (ohne Mittagspause):</label>
                        <input type="text" id="zusatzpause" placeholder="00h 00min">
                    </div>
                    <div class="form-row">
                        <label></label>
                        <button id="berechnen" onclick="berechneArbeitszeit()">Berechnen</button>
                    </div>
                </div>

                <div class="results-section">
                    <div class="result-item">
                        <div class="result-label">Arbeitsbeginn:</div>
                        <div class="result-value" id="result-arbeitsbeginn">08:54 Uhr</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Pausenzeit:</div>
                        <div class="result-value" id="result-pausenzeit">
                            <p>Sie arbeiten weniger als 6h 0m.</p>
                            <p>Es wurde noch keine Mittagspause mit eingerechnet.</p>
                        </div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Anwesenheit:</div>
                        <div class="result-value" id="result-anwesenheit">Aktuell sind Sie seit 0h 0min anwesend.</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Tagessoll:</div>
                        <div class="result-value" id="result-tagessoll">Um die Tagessollzeit zu erreichen (inkl. Pausenzeiten), müssen Sie noch 0h 0min arbeiten.</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Feierabend:</div>
                        <div class="result-value highlight" id="result-feierabend">Sie können um 00:00 Uhr gehen.</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Arbeit außer Rahmen:</div>
                        <div class="result-value" id="result-limit">Um 00:00 Uhr haben Sie 10h Anwesenheit erreicht.</div>
                    </div>
                </div>

                <div class="timeline-container">
                    <div class="timeline-labels">
                        <span id="timeline-start">08:54</span>
                        <span id="timeline-current">--:--</span>
                        <span id="timeline-end">19:24</span>
                    </div>
                    <div class="timeline-bar">
                        <div class="timeline-segment segment-present" id="segment-present"></div>
                        <div class="timeline-segment segment-remaining" id="segment-remaining"></div>
                        <div class="timeline-segment segment-overtime" id="segment-overtime"></div>
                    </div>
                    <div class="timeline-legend">
                        <div class="legend-item">
                            <div class="legend-color segment-present"></div>
                            <span>Anwesenheit</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color segment-remaining"></div>
                            <span>Verbleibende Arbeitszeit</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color segment-overtime"></div>
                            <span>Überstunden möglich</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-panel">
                <div class="clock-container">
                    <div id="digital-clock">00:00</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Time calculation utility class
        class TimeCalculator {
            constructor() {
                this.TAGESSOLL_MINUTEN = 7 * 60 + 54; // 7h 54min
                this.MAX_ARBEITSZEIT = 10 * 60; // 10 hours maximum work time
            }

            // Convert time string (HH:MM) to minutes since midnight
            timeToMinutes(timeStr) {
                const [hours, minutes] = timeStr.split(':').map(Number);
                return hours * 60 + minutes;
            }

            // Convert minutes to time string (HH:MM)
            minutesToTime(totalMinutes) {
                // Handle day overflow
                while (totalMinutes >= 24 * 60) {
                    totalMinutes -= 24 * 60;
                }
                while (totalMinutes < 0) {
                    totalMinutes += 24 * 60;
                }
                
                const hours = Math.floor(totalMinutes / 60);
                const minutes = totalMinutes % 60;
                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            }

            // Format minutes as duration (Xh Ymin)
            formatDuration(minutes) {
                const absMinutes = Math.abs(minutes);
                const hours = Math.floor(absMinutes / 60);
                const mins = absMinutes % 60;
                return `${hours}h ${mins}min`;
            }

            // Calculate required break time based on work duration
            calculateBreakTime(arbeitsMinuten) {
                if (arbeitsMinuten > 9 * 60) {
                    return 45; // 45 minutes break for more than 9 hours
                } else if (arbeitsMinuten > 6 * 60) {
                    return 30; // 30 minutes break for more than 6 hours
                }
                return 0; // No mandatory break for 6 hours or less
            }

            // Parse additional break input (format: "XXh YYmin")
            parseAdditionalBreak(breakStr) {
                if (!breakStr || breakStr.trim() === '') {
                    return 0;
                }
                
                // Try to match patterns like "1h 30min", "2h", "45min"
                const match = breakStr.match(/(?:(\d+)\s*h)?\s*(?:(\d+)\s*min)?/i);
                if (match) {
                    const hours = parseInt(match[1] || 0);
                    const minutes = parseInt(match[2] || 0);
                    return hours * 60 + minutes;
                }
                return 0;
            }

            // Calculate time difference handling day boundaries
            timeDifference(startMinutes, endMinutes) {
                let diff = endMinutes - startMinutes;
                // If negative, we've crossed midnight
                if (diff < 0) {
                    diff += 24 * 60;
                }
                return diff;
            }
        }

        // Global calculator instance
        const calculator = new TimeCalculator();

        // Update digital clock
        function updateClock() {
            const now = new Date();
            const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            document.getElementById('digital-clock').textContent = timeStr;
        }

        // Main calculation function
        function berechneArbeitszeit() {
            // Get input values
            const arbeitsbeginnStr = document.getElementById('arbeitsbeginn').value;
            const zusatzpauseStr = document.getElementById('zusatzpause').value;
            
            // Validate input
            if (!arbeitsbeginnStr) {
                alert('Bitte geben Sie einen Arbeitsbeginn ein.');
                return;
            }
            
            // Get current time
            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            
            // Parse times
            const arbeitsbeginnMinuten = calculator.timeToMinutes(arbeitsbeginnStr);
            const zusatzpauseMinuten = calculator.parseAdditionalBreak(zusatzpauseStr);
            
            // Calculate mandatory break
            const pflichtpause = calculator.calculateBreakTime(calculator.TAGESSOLL_MINUTEN);
            const gesamtpause = pflichtpause + zusatzpauseMinuten;
            
            // Calculate total required presence time
            const erforderlicheAnwesenheit = calculator.TAGESSOLL_MINUTEN + gesamtpause;
            
            // Calculate end of work time
            const feierabendMinuten = arbeitsbeginnMinuten + erforderlicheAnwesenheit;
            
            // Calculate current presence
            const anwesenheitMinuten = calculator.timeDifference(arbeitsbeginnMinuten, currentMinutes);
            
            // Calculate remaining work time
            const verbleibendeZeit = Math.max(0, erforderlicheAnwesenheit - anwesenheitMinuten);
            
            // Calculate 10-hour limit (including mandatory break)
            const zehnsStundenLimit = arbeitsbeginnMinuten + calculator.MAX_ARBEITSZEIT + pflichtpause;
            
            // Update display
            updateDisplay(
                arbeitsbeginnStr,
                pflichtpause,
                zusatzpauseMinuten,
                anwesenheitMinuten,
                verbleibendeZeit,
                feierabendMinuten,
                zehnsStundenLimit
            );
            
            // Update timeline
            updateTimeline(
                arbeitsbeginnMinuten,
                currentMinutes,
                feierabendMinuten,
                zehnsStundenLimit,
                anwesenheitMinuten
            );
        }

        // Update display with calculated values
        function updateDisplay(arbeitsbeginn, pflichtpause, zusatzpause, anwesenheit, verbleibend, feierabend, limit) {
            // Arbeitsbeginn
            document.getElementById('result-arbeitsbeginn').textContent = `${arbeitsbeginn} Uhr`;
            
            // Pausenzeit
            let pausenText = '';
            if (calculator.TAGESSOLL_MINUTEN <= 6 * 60) {
                pausenText = `<p>Sie arbeiten weniger als 6h 0m.</p>`;
                pausenText += `<p>Es wurde keine Mittagspause mit eingerechnet.</p>`;
            } else if (calculator.TAGESSOLL_MINUTEN <= 9 * 60) {
                pausenText = `<p>Sie arbeiten mehr als 6h 0m.</p>`;
                pausenText += `<p>Gesetzliche Pausenzeit: ${calculator.formatDuration(pflichtpause)}.</p>`;
            } else {
                pausenText = `<p>Sie arbeiten mehr als 9h 0m.</p>`;
                pausenText += `<p>Gesetzliche Pausenzeit: ${calculator.formatDuration(pflichtpause)}.</p>`;
            }
            
            if (zusatzpause > 0) {
                pausenText += `<p>Zusätzliche Pause: ${calculator.formatDuration(zusatzpause)}.</p>`;
            }
            
            document.getElementById('result-pausenzeit').innerHTML = pausenText;
            
            // Anwesenheit
            document.getElementById('result-anwesenheit').textContent = 
                `Aktuell sind Sie seit ${calculator.formatDuration(anwesenheit)} anwesend.`;
            
            // Tagessoll
            if (verbleibend > 0) {
                document.getElementById('result-tagessoll').textContent = 
                    `Um die Tagessollzeit zu erreichen (inkl. Pausenzeiten), müssen Sie noch ${calculator.formatDuration(verbleibend)} arbeiten.`;
            } else {
                document.getElementById('result-tagessoll').textContent = 
                    `Sie haben Ihre Tagessollzeit bereits erreicht!`;
            }
            
            // Feierabend
            document.getElementById('result-feierabend').textContent = 
                `Sie können um ${calculator.minutesToTime(feierabend)} Uhr gehen.`;
            
            // 10-Stunden-Limit
            document.getElementById('result-limit').textContent = 
                `Um ${calculator.minutesToTime(limit)} Uhr haben Sie 10h Anwesenheit erreicht.`;
        }

        // Update timeline visualization
        function updateTimeline(start, current, end, limit, presence) {
            // Update timeline labels
            document.getElementById('timeline-start').textContent = calculator.minutesToTime(start);
            document.getElementById('timeline-current').textContent = calculator.minutesToTime(current);
            document.getElementById('timeline-end').textContent = calculator.minutesToTime(limit);
            
            // Calculate percentages for timeline segments
            const totalSpan = calculator.timeDifference(start, limit);
            const presenceSpan = Math.min(presence, totalSpan);
            const endSpan = calculator.timeDifference(start, end);
            
            // Calculate percentages
            const presencePercent = (presenceSpan / totalSpan) * 100;
            const remainingPercent = Math.max(0, Math.min((endSpan - presenceSpan) / totalSpan * 100, 100 - presencePercent));
            const overtimePercent = Math.max(0, 100 - presencePercent - remainingPercent);
            
            // Update segment widths
            document.getElementById('segment-present').style.width = `${presencePercent}%`;
            document.getElementById('segment-remaining').style.width = `${remainingPercent}%`;
            document.getElementById('segment-overtime').style.width = `${overtimePercent}%`;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Update clock immediately and then every second
            updateClock();
            setInterval(updateClock, 1000);
            
            // Perform initial calculation
            berechneArbeitszeit();
            
            // Add enter key support for inputs
            document.getElementById('arbeitsbeginn').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') berechneArbeitszeit();
            });
            
            document.getElementById('zusatzpause').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') berechneArbeitszeit();
            });
        });
    </script>
</body>
</html>