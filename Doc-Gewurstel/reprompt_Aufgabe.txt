<context>
Die Aufgabe besteht darin, ein Firefox-Plugin zu entwickeln, das die Integration von Model Context Protocol (MCP) Tools mit einer Vielzahl von AI-Plattformen ermöglicht. Diese AI-Plattformen umfassen manus.im, perplexity.ai, gemini.google.co, chatgpt.ai und claude.ai. Das Plugin sollte eine standardisierte Schnittstelle bereitstellen, um AI-Modelle mit externen Tools und Datenquellen zu verbinden, basierend auf dem MCP-Standard.
</context>

<instruction>
1. Implementiere das MCP-Server-Finder-Modell im Plugin, um MCP-kompatible Server zu erkennen und zu verwalten.
2. Erstelle eine Client-Server-Architektur, die es ermöglicht, mehrere MCP-Server mit dem Plugin zu verbinden.
3. Entwickle eine Benutzeroberfläche, die Benutzern ermöglicht, MCP-Tools mit der gewünschten AI-Plattform zu verknüpfen.
4. Implementiere die Logik zur Verwaltung von Tokenbegrenzungen und zur dynamischen Kontextabfrage, um realistische Interaktionen zu gewährleisten.
5. Integriere Sicherheitsmaßnahmen zur Authentifizierung und zur Vermeidung von Datenverlust.
6. Entwickle Einheiten- und Integrationstests, um die Funktionalität des Plugins sicherzustellen.
7. Achte darauf dass du mit Manifest V2 arbeitest, Manifest V3 macht erfahrungsgemäß Probleme bei dieser art des Plugin.
</instruction>

<examples>
- **Example 1: Implementing MCP-Server-Finder with Multi-Server Client-Server Architecture (Intermediate Complexity, Network Management Use Case)**  
  - *Scenario:* A developer needs to build a plugin that detects and manages multiple MCP-compatible Minecraft servers, allowing seamless connection and interaction from a single client interface.  
  - *Implementation Approach:*  
    - Develop the MCP-Server-Finder model integrated within the plugin to scan and identify MCP servers on the network using server metadata and protocol handshake validation.  
    - Architect a client-server communication layer using WebSocket or gRPC, enabling the client to maintain persistent, multiplexed connections to multiple MCP servers concurrently.  
    - Implement server discovery caching and retry logic to handle transient network issues.  
    - Use Manifest V2 for the plugin manifest to ensure compatibility and avoid known Manifest V3 pitfalls with this plugin type.  
  - *Technical Details:*  
    - The plugin listens on predefined ports or uses multicast DNS for server discovery.  
    - Connection management includes heartbeat pings to detect dropped connections.  
    - Authentication tokens are exchanged at connection start, complying with the security requirements to prevent unauthorized access.  
  - *Expected Outcomes:*  
    - The client successfully lists all detected MCP servers, displaying server status and metadata dynamically.  
    - Users can manage and interact with any connected MCP server through the plugin without disconnections or data loss.  
    - The architecture supports horizontal scaling by adding more servers seamlessly.  

- **Example 2: User Interface for MCP-Tool and AI-Platform Integration with Token Management (Advanced Use Case for User Interaction and API Integration)**  
  - *Scenario:* A product team wants a UI that allows users to link MCP tools with different AI platforms, managing token limits and dynamic context queries for realistic AI-driven interactions.  
  - *Implementation Approach:*  
    - Design a frontend UI using React or Vue.js that lists available MCP tools and AI platforms with OAuth-style authentication flows.  
    - Implement backend logic in the plugin to handle token allocation per user session, monitoring API token usage against set limits dynamically.  
    - Develop a context-fetching mechanism that queries relevant conversation history or server state dynamically, adjusting prompt size to stay within token constraints.  
    - Include error handling for token exhaustion and provide UI feedback with options to renew tokens or reduce context size.  
  - *Technical Details:*  
    - Use secure storage mechanisms (e.g., encrypted storage, environment variables) for API keys and tokens.  
    - Integrate rate limiting middleware to enforce token quotas and avoid API overuse.  
    - The plugin uses Manifest V2 to maintain compatibility while integrating the UI as part of the plugin’s extension points.  
  - *Expected Outcomes:*  
    - Users can seamlessly link their MCP tools with AI platforms and maintain realistic, context-aware interactions without exceeding token limits.  
    - The UI clearly notifies users of token usage status and offers smooth token renewal workflows.  
    - The system prevents data loss or unauthorized API calls through robust authentication and token management.  

- **Example 3: Security-Focused Implementation with Authentication and Testing in Manifest V2 Plugin (High Complexity, Security and Reliability Use Case)**  
  - *Scenario:* A security-conscious developer must implement and verify a plugin that detects MCP servers by authenticating connections and preventing data breaches, with comprehensive unit and integration tests.  
  - *Implementation Approach:*  
    - Implement OAuth2-based authentication or API key validation at all plugin-server interfaces to ensure only authorized MCP servers are recognized and managed.  
    - Integrate encryption protocols (TLS) for all client-server communication to safeguard against man-in-the-middle attacks.  
    - Develop Jest or PyTest unit tests validating individual components: server detection logic, token limit handling, and security middleware.  
    - Create integration tests simulating multi-server discovery, authentication failures, and token exhaustion scenarios.  
    - Package the plugin using Manifest V2, ensuring the manifest specifies minimum required permissions and avoids Manifest V3 complications.  
  - *Technical Details:*  
    - Use mock servers and token stubs in tests to simulate MCP server behaviors and API endpoints.  
    - Security audits include static code analysis and penetration testing where feasible.  
    - Define CI/CD pipelines to automatically run test suites on plugin updates to ensure no regressions in security or functionality.  
  - *Expected Outcomes:*  
    - The plugin robustly authenticates MCP servers and rejects unauthorized access attempts.  
    - Data transmitted is encrypted, and no data leakage occurs even under adversarial conditions.  
    - The testing framework provides high confidence in plugin stability, with quick detection of any regressions or security flaws before deployment.
</examples>

<constraints>
- **Performance**: Das Plugin sollte effizient mit geringen Systemressourcen arbeiten.
- **Sicherheit**: Implementiere Maßnahmen zur Authentifizierung und Autorisierung bei der Verbindung mit externen Diensten.
- **Stil**: Die Benutzeroberfläche sollte sich in das Firefox-Design einfügen.
- **Kompatibilität**: Stelle sicher, dass das Plugin mit verschiedenen Firefox-Versionen kompatibel ist.
</constraints>

<format>
- **Code**: Implementierung in JavaScript mit der Verwendung von Firefox WebExtensions-API.
- **API-Dokumentation**: Dokumentation der MCP-Integration und der verwendeten APIs.
- **Komponentenbaum**: Beschreibung der Komponenten und ihrer Interaktionen.
</format>